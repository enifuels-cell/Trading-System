<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Analyzer - Trading Analysis Platform</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard-styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>Trading Analysis Platform</h1>
            </div>
            <div class="nav-menu">
                <a href="/dashboard" class="nav-link">Dashboard</a>
                <a href="/analyzer" class="nav-link active">New Analysis</a>
                <div class="user-menu">
                    <span id="userFullName" class="user-name"></span>
                    <button id="logoutBtn" class="btn-logout">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <main>
            <!-- Analysis Settings -->
            <section class="settings-section">
                <h2>Analysis Settings</h2>
                <div class="settings-grid">
                    <div class="setting-group">
                        <label for="assetType">Asset Type</label>
                        <select id="assetType" class="setting-select">
                            <option value="Crypto">Cryptocurrency</option>
                            <option value="Forex">Forex</option>
                            <option value="Stocks">Stocks</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="tradingStyle">Trading Style</label>
                        <select id="tradingStyle" class="setting-select">
                            <option value="Scalping">Scalping (Minutes to Hours)</option>
                            <option value="Day Trade" selected>Day Trading (Intraday)</option>
                            <option value="Swing">Swing Trading (Days to Weeks)</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="riskProfile">Risk Profile</label>
                        <select id="riskProfile" class="setting-select">
                            <option value="Conservative">Conservative (Lower Risk)</option>
                            <option value="Balanced" selected>Balanced (Moderate Risk)</option>
                            <option value="Aggressive">Aggressive (Higher Risk)</option>
                        </select>
                    </div>
                </div>
            </section>
            <!-- Upload Section -->
            <section class="upload-section">
                <div class="upload-box" id="uploadBox">
                    <input type="file" id="chartInput" accept="image/*" hidden>
                    <div class="upload-content">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"></path>
                        </svg>
                        <h3>Upload Trading Chart</h3>
                        <p>Click to browse or drag and drop</p>
                        <p class="file-types">Supports: PNG, JPG, JPEG, GIF, WEBP (Max 10MB)</p>
                    </div>
                    <img id="previewImage" class="preview-image" style="display: none;" alt="Chart preview">
                </div>
                <button id="analyzeBtn" class="btn btn-primary" disabled>Analyze Chart</button>
            </section>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing your chart... This may take a few moments.</p>
            </div>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <h2>Analysis Results</h2>
                
                <div class="result-card">
                    <div class="card-header">
                        <h3>Market Overview</h3>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="label">Market Type:</span>
                            <span id="marketType" class="value"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">Confidence Score:</span>
                            <span id="confidenceScore" class="value confidence-badge"></span>
                        </div>
                    </div>
                </div>

                <div class="result-card">
                    <div class="card-header">
                        <h3>Identified Patterns</h3>
                    </div>
                    <div class="card-content">
                        <div id="patternsList" class="tags-container"></div>
                    </div>
                </div>

                <div class="result-card">
                    <div class="card-header">
                        <h3>Technical Indicators</h3>
                    </div>
                    <div class="card-content">
                        <div id="indicatorsList" class="tags-container"></div>
                    </div>
                </div>

                <div class="result-card trade-setup-card">
                    <div class="card-header">
                        <h3>Suggested Trade Setup</h3>
                    </div>
                    <div class="card-content">
                        <div class="trade-direction" id="tradeDirection"></div>
                        <div class="trade-levels">
                            <div class="level-item">
                                <span class="level-label">Entry Point</span>
                                <span id="entryLevel" class="level-value entry"></span>
                            </div>
                            <div class="level-item">
                                <span class="level-label">Stop Loss</span>
                                <span id="stopLoss" class="level-value stop"></span>
                            </div>
                            <div class="level-item">
                                <span class="level-label">Take Profit</span>
                                <div id="takeProfitLevels" class="level-value profit"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="result-card">
                    <div class="card-header">
                        <h3>Pattern Explanation</h3>
                    </div>
                    <div class="card-content">
                        <p id="patternExplanation" class="explanation-text"></p>
                    </div>
                </div>

                <div class="result-card">
                    <div class="card-header">
                        <h3>Trading Reasoning</h3>
                    </div>
                    <div class="card-content">
                        <p id="reasoning" class="explanation-text"></p>
                    </div>
                </div>

                <div class="result-card risk-card">
                    <div class="card-header">
                        <h3>Risk Factors</h3>
                    </div>
                    <div class="card-content">
                        <ul id="riskFactorsList" class="risk-list"></ul>
                    </div>
                </div>

                <button id="analyzeAnotherBtn" class="btn btn-secondary">Analyze Another Chart</button>
            </section>

            <!-- Error Message -->
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </main>

        <footer class="disclaimer-section">
            <h3>Important Educational Notice</h3>
            <p>
                <strong>This analysis is provided for educational purposes only</strong> and should not be considered as financial advice. 
                Trading in financial markets carries significant risk and may not be suitable for all investors. 
                Past performance is not indicative of future results. Always conduct your own research and consult with 
                a qualified financial advisor before making any investment decisions. The creators of this tool are not 
                responsible for any financial losses incurred based on this analysis.
            </p>
            <p style="margin-top: 15px;">
                <strong>⚠️ Not a Signal Service:</strong> This platform does not provide trading signals or financial advice. 
                All analyses are automated and for educational purposes only.
            </p>
        </footer>
    </div>

    <script src="analyzer-script.js"></script>
    <script>
        // Load user info
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('userFullName').textContent = data.user.full_name;
                } else {
                    window.location.href = '/login';
                }
            } catch (error) {
                window.location.href = '/login';
            }
            
            // Logout handler
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                try {
                    await fetch('/api/logout', { method: 'POST' });
                } catch (error) {
                    console.error('Logout error:', error);
                }
                window.location.href = '/login';
            });
        });
    </script>
</body>
</html>
